{
    "parameters": [
        {
            "meta": {
                "validation": {
                    "required": true
                },
                "description": "ID of the deal to update.",
                "displayName": "Deal ID",
                "displayType": "text",
                "placeholder": "Enter the Deal ID"
            },
            "name": "id"
        }
    ],
    "getDealViews": {
        "definition": {
            "qs": {},
            "url": "{{secrets.api_url}}/api/deals/filters",
            "method": "get",
            "headers": {
                "Authorization": "Token token={{secrets.api_key}}"
            },
            "response": {
                "error": {
                    "code": "{{response.data.errors.code}}",
                    "message": "{{response.data.errors.message}}"
                },
                "output": "{{response.data.filters}}"
            }
        }
    },
    "getMoreParameters": {
        "definition": {
            "qs": {},
            "url": "{{secrets.api_url}}/api/settings/deals/fields",
            "method": "get",
            "headers": {
                "Authorization": "Token token={{secrets.api_key}}"
            },
            "response": {
                "error": {
                    "code": "{{response.data.errors.code}}",
                    "message": "{{response.data.errors.message}}"
                },
                "output": "{{response.data.fields}}"
            },
            "transform": {
                "output": "const result = output.map((ele) => { const excludeParameters = [ 'last_contacted', 'last_contacted_mode', 'last_contacted_sales_activity_mode', 'completed_sales_sequences', 'recent_note', 'creater_id', 'updater_id', 'created_at', 'updated_at', 'last_assigned_at', ]; if (!excludeParameters.includes(ele.name)) { const typeMap = { text: 'text', textarea: 'textarea', dropdown: 'select', auto_complete: 'multitext', multi_select_dropdown: 'multiselect', radio: 'radio', number: 'number', }; const newObj = { name: ele.name, meta: { displayName: ele.label, displayType: typeMap[ele.type] || 'text', placeholder: ele.label, description: ele.label, validation: { required: ele.required, }, }, }; if (['dropdown', 'radio', 'multi_select_dropdown'].includes(ele.type)) { if (ele.choices && ele.choices.length) { newObj.meta.options = ele.choices.map((choice) => ({ label: choice.value, value: choice.id, })); if (ele.type === 'dropdown') { newObj.meta.htmlProps = { allowDynamic: true }; } } else { newObj.meta.displayType = 'text'; } if (ele.type === 'multi_select_dropdown') { newObj.meta.value = []; } } if (ele.default === false) { newObj.prop = 'custom_field'; } return newObj; } return null; }).filter((ele) => ele !== null); let custom_field = { name: 'custom_field', meta: { children: [], displayType: 'object', }, }; const outputWithCustomField = result.reduce((acc, ele) => { if (ele.prop === 'custom_field') { custom_field.meta.children.push(ele); } else { acc.push(ele); } return acc; }, []); if (custom_field.meta.children.length > 0) { outputWithCustomField.push(custom_field); } return outputWithCustomField"
            }
        }
    },
    "definition": {
        "qs": {},
        "url": "{{secrets.api_url}}/api/deals/{{parameters.id}}",
        "body": "{{parameters}}",
        "method": "put",
        "headers": {
            "Authorization": "Token token={{secrets.api_key}}"
        },
        "response": {
            "error": {
                "code": "{{response.data.errors.code}}",
                "message": "{{response.data.errors.message}}"
            },
            "output": "{{response.data}}"
        }
    },
    "config": {
        "url": "integrations/parameters",
        "body": {
            "name": "freshsales",
            "secret": "{{parameters.secret}}",
            "resource": "deal",
            "loadParametersMethod": "getMoreParameters"
        },
        "method": "post",
        "urlType": "parameters"
    }
}
